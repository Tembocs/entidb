# EntiDB Production-Readiness TODO (01 Jan 2026 — 1)

This file records confirmed release blockers and recommended fixes based on a deep repo review.

## RB-01 — Panic in production paths when encryption is disabled

**Evidence**
- `crates/entidb_core/src/crypto/mod.rs:45`
- `crates/entidb_core/src/crypto/mod.rs:63`

**Impact**
- Violates the hard rule: no `panic!/unwrap()/expect()` in non-test, non-example, non-benchmark code.
- A panic in core crypto paths can terminate the process and corrupt active sessions.

**Suggested fix**
- Make these APIs fallible and return `CoreResult` (or another typed error) rather than panicking.
- Alternatively gate the APIs behind `#[cfg(feature = "encryption")]` so callers get a compile-time error when the feature is disabled.
- This follows database reliability principles: errors must be explicit and recoverable, not process-killing.

## RB-02 — Canonical CBOR negative integer ordering is incorrect

**Evidence**
- `crates/entidb_codec/src/value.rs:63`

**Impact**
- The current comparison places `-2` before `-1`, which contradicts bytewise canonical CBOR ordering.
- Breaks deterministic encoding, stable hashing, and cross-language test vectors (AC-01, AC-12).

**Suggested fix**
- Compare integer keys by their canonical encoded bytes (length first, then lexicographic), or
- For negative integers, compare by the CBOR “argument” (i.e., `-1 - n`) as an unsigned value to match encoded ordering.
- This preserves deterministic map ordering and stable content hashes.

## RB-03 — Password-based key derivation is non-cryptographic

**Evidence**
- `crates/entidb_core/src/crypto/encrypted.rs:66`
- `crates/entidb_core/src/crypto/encrypted.rs:69`
- `crates/entidb_core/src/crypto/encrypted.rs:76`

**Impact**
- Uses `DefaultHasher`, which is not a cryptographic KDF.
- Violates the documented security model and weakens protection against offline guessing.

**Suggested fix**
- Implement HKDF (HMAC-SHA256) as documented, or
- Prefer a password-hardening KDF (Argon2id or PBKDF2 with explicit parameters).
- This aligns with standard database encryption-at-rest practices.
